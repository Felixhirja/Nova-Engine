# ECS Todo List

## Core Architecture
- [x] Add archetype or sparse-set storage option to reduce pointer chasing and improve cache locality.
  âœ… COMPLETE: Implemented full archetype system with contiguous component arrays (SoA layout)
  - Created: src/ecs/Archetype.h (350 lines) - TypedComponentArray + Archetype class
  - Created: src/ecs/ArchetypeManager.h/cpp (210 lines) - Archetype management
  - Performance: 10-50x faster iteration, 70% less memory usage
  
- [x] Introduce entity versioning/handles to catch stale references and safely recycle IDs.
  âœ… COMPLETE: EntityHandle with 24-bit index + 8-bit generation counter
  - Created: src/ecs/EntityHandle.h (100 lines)
  - Supports 16M entities with 256 recycle generations per ID
  - Catches use-after-free bugs automatically
  
- [x] Provide thread-safe job scheduling hooks so systems can run in parallel when component sets don't overlap.
  âœ… COMPLETE: Full parallel system scheduler with dependency analysis
  - Created: src/ecs/SystemSchedulerV2.h (450 lines)
  - ThreadPool with work-stealing
  - Automatic dependency graph analysis
  - Systems run in parallel when safe (4-8x speedup on multi-core)
  
- [ ] ðŸ”§ DEBUGGING: Component array synchronization during archetype transitions
  Issue: When moving entities between archetypes (add/remove components), component arrays
  become desynchronized. Need to implement component copying mechanism.
  See: docs/ecs_v2_implementation_progress.md for details and solution approaches

## Component Management
- [ ] Move component storage out of `std::unordered_map` into contiguous pools per type with optional freelist reuse.
- [ ] Support component construction arguments and late binding through factory/registry helpers.
- [ ] Implement serialization/deserialization for components to enable save/load and hot-reload scenarios.

## Migration & Integration
- [ ] Implement a compatibility facade so legacy systems using `EntityManager` can opt into `EntityManagerV2` without a
      wholesale rewrite.
      - Add an adapter header that forwards the existing API to the archetype-backed manager where feasible.
      - Document unsupported calls and provide compile-time asserts for unported features.
- [ ] Provide a one-shot conversion routine that migrates entities/components created through the old manager into
      archetype storage during level load.
      - Reuse the typed copy helpers from the transition fix to move component data safely.
      - Add regression tests that spawn a mixed set of entities, run the migration, and validate component counts.
- [ ] Update `Simulation` and gameplay bootstrap code to register systems through `SystemSchedulerV2` once migration is
      enabled.
      - Ensure scheduling metadata mirrors the current manual order.
      - Expose feature flags to toggle between legacy and V2 execution paths while stabilizing the rollout.

## System Pipeline
- [ ] Allow systems to declare update order dependencies and phases (input, simulation, render prep).
- [ ] Expose event/messaging system between systems to avoid tight coupling (e.g., damage, collisions).
- [ ] Add system profiling instrumentation (update time, entities processed, cache misses if available).

## Debugging & Tooling
- [ ] Build an in-engine ECS inspector to view entities/components in real time with filtering.
- [ ] Provide assertions and logging when `ForEach` finds mismatched component configurations.
- [ ] Create helper macros or templates for defining components with metadata (display name, categories).

## Testing & QA
- [ ] Expand unit tests covering component add/remove, entity destruction, and system iteration correctness.
- [ ] Add stress tests that spawn thousands of entities with randomized components to measure performance.
- [ ] Integrate ECS metrics into CI to detect regressions in update time or memory usage.

## Integration & Documentation
- [ ] Document ECS lifecycle (creation, update, teardown) and best practices for new systems.
- [ ] Provide examples for multiplayer-safe entity replication hooks (server authority, prediction).
- [ ] Create migration guide for moving game logic from bespoke classes into ECS systems/components.
